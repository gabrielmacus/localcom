{"version":3,"sources":["webpack:///./stores.js","webpack:///./pages/Room.svelte","webpack:///./components/Button.svelte","webpack:///../node_modules/peerjs/dist sync"],"names":["ENV","host","port","path","config","url","credential","username","user","users","talk","bind","hang","status","length","popupNotification","call","interval","localStream","peer","peerOptions","loadUsers","listAllPeers","peers","console","log","filter","navigator","mediaDevices","getUserMedia","audio","video","then","stream","catch","error","router","route","clearInterval","on","evt","setInterval","answer","remoteStream","document","querySelector","srcObject","msg","type","this","i","open","close","loadingContent","loading","style","disabled","pressed","className","webpackEmptyContext","req","e","Error","code","keys","resolve","module","exports","id"],"mappings":"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","file":"2.chunk.efcb9.js","sourcesContent":["import { writable } from 'svelte/store';\r\n\r\n\r\n\r\n//ENV\r\nexport const ENV_PROD =  {\r\n  \"peerOptions\":{host: 'gamac.tech',port:9000, path: '/', config:{ 'iceServers': [\r\n    {url:'stun:stun01.sipphone.com'},\r\n  {url:'stun:stun.ekiga.net'},\r\n  {url:'stun:stun.fwdnet.net'},\r\n  {url:'stun:stun.ideasip.com'},\r\n  {url:'stun:stun.iptel.org'},\r\n  {url:'stun:stun.rixtelecom.se'},\r\n  {url:'stun:stun.schlund.de'},\r\n  {url:'stun:stun.l.google.com:19302'},\r\n  {url:'stun:stun1.l.google.com:19302'},\r\n  {url:'stun:stun2.l.google.com:19302'},\r\n  {url:'stun:stun3.l.google.com:19302'},\r\n  {url:'stun:stun4.l.google.com:19302'},\r\n  {url:'stun:stunserver.org'},\r\n  {url:'stun:stun.softjoys.com'},\r\n  {url:'stun:stun.voiparound.com'},\r\n  {url:'stun:stun.voipbuster.com'},\r\n  {url:'stun:stun.voipstunt.com'},\r\n  {url:'stun:stun.voxgratia.org'},\r\n  {url:'stun:stun.xten.com'},\r\n  {\r\n  \turl: 'turn:numb.viagenie.ca',\r\n  \tcredential: 'muazkh',\r\n  \tusername: 'webrtc@live.com'\r\n  },\r\n  {\r\n  \turl: 'turn:192.158.29.39:3478?transport=udp',\r\n  \tcredential: 'JZEOEt2V3Qb0y27GRntt2u2PAYA=',\r\n  \tusername: '28224511:1379330808'\r\n  },\r\n  {\r\n  \turl: 'turn:192.158.29.39:3478?transport=tcp',\r\n  \tcredential: 'JZEOEt2V3Qb0y27GRntt2u2PAYA=',\r\n  \tusername: '28224511:1379330808'\r\n  }\r\n\r\n  ] }}\r\n}\r\nexport const ENV_DEV = {\r\n  \"peerOptions\":{host: 'gamac.tech',port:9000, path: '/', config:{ 'iceServers': [\r\n    {url:'stun:stun01.sipphone.com'},\r\n  {url:'stun:stun.ekiga.net'},\r\n  {url:'stun:stun.fwdnet.net'},\r\n  {url:'stun:stun.ideasip.com'},\r\n  {url:'stun:stun.iptel.org'},\r\n  {url:'stun:stun.rixtelecom.se'},\r\n  {url:'stun:stun.schlund.de'},\r\n  {url:'stun:stun.l.google.com:19302'},\r\n  {url:'stun:stun1.l.google.com:19302'},\r\n  {url:'stun:stun2.l.google.com:19302'},\r\n  {url:'stun:stun3.l.google.com:19302'},\r\n  {url:'stun:stun4.l.google.com:19302'},\r\n  {url:'stun:stunserver.org'},\r\n  {url:'stun:stun.softjoys.com'},\r\n  {url:'stun:stun.voiparound.com'},\r\n  {url:'stun:stun.voipbuster.com'},\r\n  {url:'stun:stun.voipstunt.com'},\r\n  {url:'stun:stun.voxgratia.org'},\r\n  {url:'stun:stun.xten.com'},\r\n  {\r\n  \turl: 'turn:numb.viagenie.ca',\r\n  \tcredential: 'muazkh',\r\n  \tusername: 'webrtc@live.com'\r\n  },\r\n  {\r\n  \turl: 'turn:192.158.29.39:3478?transport=udp',\r\n  \tcredential: 'JZEOEt2V3Qb0y27GRntt2u2PAYA=',\r\n  \tusername: '28224511:1379330808'\r\n  },\r\n  {\r\n  \turl: 'turn:192.158.29.39:3478?transport=tcp',\r\n  \tcredential: 'JZEOEt2V3Qb0y27GRntt2u2PAYA=',\r\n  \tusername: '28224511:1379330808'\r\n  }\r\n\r\n  ] }}\r\n}\r\n\r\nexport const ENV = ENV_PROD\r\n","<script>\r\nimport Navaid from 'navaid';\r\nimport Peer from 'peerjs';\r\nimport { ENV } from '../stores.js';\r\nimport { User } from '../services.js'\r\nimport Layout from './Layout.svelte'\r\nimport Button from '../components/Button.svelte'\r\nimport { fade } from 'svelte/transition';\r\nimport { onDestroy, onMount, getContext } from 'svelte'\r\n\r\nconst { popupNotification } = getContext(\"layout\")\r\nlet user = User()\r\nlet users = []\r\nlet status = \"connecting\"\r\nlet call\r\nlet peer = new Peer(user.username,ENV.peerOptions)\r\nlet interval\r\nlet localStream\r\n\r\nonMount(()=>{\r\n  navigator.mediaDevices.getUserMedia({audio:true,video:false})\r\n  .then((stream)=>{\r\n    localStream = stream\r\n  })\r\n  .catch((error)=>{\r\n    popupNotification('Debe aceptar compartir su micrófono','error',3000)\r\n    User(false)\r\n    router.route(\"/login\")\r\n  })\r\n})\r\n\r\nonDestroy(()=>{\r\n  if(interval)\r\n  {\r\n    clearInterval(interval)\r\n  }\r\n})\r\npeer.on('open',(evt)=>{\r\n  status = \"connected\"\r\n  loadUsers()\r\n  interval = setInterval(loadUsers,1500)\r\n})\r\npeer.on('call', (call) => {\r\n  call.answer(localStream);\r\n  status = `user-talking:${call.peer}`\r\n  call.on('stream', (remoteStream) => {\r\n    document.querySelector(`[data-audio='${call.peer}']`).srcObject = remoteStream\r\n  });\r\n  call.on('close',()=>{\r\n    status = `connected`\r\n  })\r\n\r\n});\r\npeer.on('error',(evt)=>{\r\n\r\n  let msg\r\n  switch(evt.type)\r\n  {\r\n    case \"server-error\":\r\n    case \"disconnected\":\r\n    case \"network\":\r\n    case \"invalid-id\":\r\n    case \"unavailable-id\":\r\n\r\n      if(evt.type == \"invalid-id\")\r\n      {\r\n        msg = \"Nombre de usuario no válido\"\r\n      }\r\n      else if(evt.type == \"unavailable-id\")\r\n      {\r\n        msg = \"Nombre de usuario no disponible\"\r\n      }\r\n      else\r\n      {\r\n        msg = \"Error en la conexión. Inténtelo de nuevo o contacte un administrador\"\r\n      }\r\n      User(false)\r\n      router.route(\"/login\")\r\n    break\r\n  }\r\n  if(msg){\r\n    popupNotification(msg,'error',3000)\r\n  }\r\n\r\n})\r\nfunction loadUsers() {\r\n  if(status == 'disconnected')\r\n  {\r\n    return\r\n  }\r\n\r\n  peer.listAllPeers((peers)=>{\r\n    console.log(peers)\r\n    users = peers.filter((peer)=>{\r\n      return peer != user.username\r\n    })\r\n\r\n  })\r\n}\r\nfunction talk()\r\n{\r\n  let user = this\r\n  call = peer.call(user,localStream)\r\n  status = `calling:${user}`\r\n\r\n  let i  = setInterval(()=>{\r\n    if(call.open)\r\n    {\r\n      status = `talking:${user}`\r\n      clearInterval(i)\r\n    }\r\n  },10)\r\n\r\n  call.on('close', ()=>{\r\n    status = `connected`\r\n    clearInterval(i)\r\n  })\r\n}\r\nfunction hang()\r\n{\r\n  status = 'connected'\r\n  if(call)\r\n  {\r\n    call.close()\r\n  }\r\n}\r\n\r\n</script>\r\n\r\n<Layout>\r\n\r\n{#if status == 'connecting'}\r\n<div class=\"loading\"  >\r\n  <i class=\"icon-spinner\"></i>\r\n</div>\r\n{/if}\r\n\r\n<span slot=\"title\">Bienvenido <span class=\"username\">{user.username}</span></span>\r\n\r\n<div class=\"container\">\r\n  <h3>Usuarios conectados</h3>\r\n  {#if users.length > 0}\r\n  <div class=\"user-list\">\r\n    {#each users as user (user)}\r\n    <div class=\"user\" class:calling={status == `calling:${user}`} class:user-talking={status == `user-talking:${user}`}  class:talking={status == `talking:${user}`}>\r\n    <span class=\"username\">{user}</span>\r\n    <!--\r\n    <i class=\"icon-user-talking icon-volume-medium\"></i>-->\r\n    <span class=\"actions\">\r\n      <Button on:touchstart={talk.bind(user)} on:mousedown={talk.bind(user)} on:touchend={hang} on:mouseup={hang}><i class=\"icon-mic\"></i></Button>\r\n      <audio data-audio={user}   autoplay hidden></audio>\r\n    </span>\r\n    </div>\r\n    {/each}\r\n  </div>\r\n  {:else}\r\n  <p class=\"no-users\">No hay usuarios conectados</p>\r\n  {/if}\r\n\r\n</div>\r\n\r\n</Layout>\r\n\r\n<style lang=\"scss\">:global(html), :global(body) {\n  height: 100%; }\n  @media all and (max-width: 768px) {\n    :global(html), :global(body) {\n      font-size: 22px; } }\n\n:global(body) {\n  display: flex; }\n\n/* W3.CSS 4.13 June 2019 by Jan Egil and Borge Refsnes */\n:global(html) {\n  box-sizing: border-box; }\n\n:global(*), :global(*):before, :global(*):after {\n  box-sizing: inherit; }\n\n/* Extract from normalize.css by Nicolas Gallagher and Jonathan Neal git.io/normalize */\n:global(html) {\n  -ms-text-size-adjust: 100%;\n  -webkit-text-size-adjust: 100%; }\n\n:global(body) {\n  margin: 0; }\n\n/* End extract */\n:global(body) {\n  background-color: #F8F5F5;\n  color: #616161; }\n\n@keyframes color_change_calling {\n  from {\n    background-color: #039be5; }\n  to {\n    background-color: #01579b; } }\n\n@keyframes color_change_talking {\n  from {\n    background-color: #69f0ae; }\n  to {\n    background-color: #00c853; } }\n\n@keyframes rotation {\n  from {\n    -webkit-transform: rotate(0deg); }\n  to {\n    -webkit-transform: rotate(360deg); } }\n\n.actions :global(button) {\n  font-size: 1rem; }\n\n.loading {\n  z-index: 5;\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 3rem;\n  background: rgba(0, 0, 0, 0.75);\n  color: white; }\n  .loading i {\n    animation-name: rotation;\n    animation-duration: 1200ms;\n    animation-iteration-count: infinite;\n    animation-timing-function: linear; }\n\n.user-list {\n  max-height: 60vh;\n  overflow: auto; }\n\n.container .user {\n  transition: all 0.3s;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding-bottom: 0.5rem;\n  padding-top: 0.5rem;\n  padding: 0.5rem; }\n  .container .user .username {\n    overflow: hidden;\n    margin-right: 0.5rem;\n    text-overflow: ellipsis; }\n  .container .user.calling {\n    padding: 0.5rem;\n    color: white;\n    animation: color_change_calling 0.5s infinite alternate; }\n  .container .user .icon-user-talking {\n    display: none;\n    margin-right: auto; }\n  .container .user.user-talking .icon-user-talking {\n    display: block; }\n  .container .user.talking {\n    padding: 0.5rem;\n    color: black;\n    animation: color_change_talking 0.5s infinite alternate; }\n  .container .user:not(:last-child) {\n    border-bottom: 1px solid lightgrey; }\n\n.container h3 {\n  position: sticky;\n  top: 0;\n  font-size: 1.1rem;\n  text-align: center;\n  padding: 0.3rem;\n  background: #e0e0e0;\n  color: black;\n  font-size: 1rem;\n  margin-bottom: 0.5rem; }\n\n/*# sourceMappingURL=Room.svelte.css.map */</style>\r\n","<script>\r\nexport let type =\"button\";\r\nexport let loadingContent;\r\nexport let loading = false;\r\nexport let disabled = false\r\nexport let pressed = false\r\nexport let style = 1\r\nexport let className\r\n</script>\r\n\r\n<div class=\"button\" >\r\n\r\n    <button class={`style-${style}`} on:mousedown on:mouseup on:touchstart on:touchend   on:click on:dblclick disabled={loading || disabled}    class:pressed={pressed} class:loading={loading} type=\"{type}\">\r\n    {#if loading}\r\n        {#if loadingContent}\r\n        <div class=\"loading\">{@html loadingContent}</div>\r\n        {:else}\r\n        <div class=\"loading\"><span class=\"icon-loading icon-spinner\"></span></div>\r\n        {/if}\r\n    {:else}\r\n        <slot></slot>\r\n    {/if}\r\n    </button>\r\n\r\n\r\n</div>\r\n<style lang=\"scss\">:global(html), :global(body) {\n  height: 100%; }\n  @media all and (max-width: 768px) {\n    :global(html), :global(body) {\n      font-size: 22px; } }\n\n:global(body) {\n  display: flex; }\n\n/* W3.CSS 4.13 June 2019 by Jan Egil and Borge Refsnes */\n:global(html) {\n  box-sizing: border-box; }\n\n:global(*), :global(*):before, :global(*):after {\n  box-sizing: inherit; }\n\n/* Extract from normalize.css by Nicolas Gallagher and Jonathan Neal git.io/normalize */\n:global(html) {\n  -ms-text-size-adjust: 100%;\n  -webkit-text-size-adjust: 100%; }\n\n:global(body) {\n  margin: 0; }\n\n/* End extract */\n:global(body) {\n  background-color: #F8F5F5;\n  color: #616161; }\n\n@keyframes rotation {\n  from {\n    -webkit-transform: rotate(0deg); }\n  to {\n    -webkit-transform: rotate(360deg); } }\n\n.loading {\n  display: flex;\n  align-items: center;\n  justify-content: center; }\n  .loading > .icon-loading {\n    font-size: 1rem;\n    animation-name: rotation;\n    animation-duration: 1000ms;\n    animation-iteration-count: infinite;\n    animation-timing-function: linear; }\n\nbutton:disabled {\n  color: black;\n  background-color: #14e38f; }\n\nbutton {\n  font-size: 0.8rem;\n  user-select: none;\n  cursor: pointer;\n  transition: 0.2s all;\n  color: white;\n  background-color: #00b16a;\n  padding: 0.5rem;\n  border: 0;\n  margin: 0;\n  display: block;\n  outline: 0;\n  width: 100%;\n  font-weight: 600;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24); }\n\nbutton.style-2 {\n  color: white;\n  background-color: #34495e; }\n\n@media (hover: hover) {\n  button.style-2:not(:disabled):hover {\n    color: white;\n    background-color: #507294; }\n  button:not(:disabled):hover {\n    color: white;\n    background-color: #34495e; } }\n\nbutton.pressed {\n  box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);\n  background-color: #009458;\n  color: white; }\n\nbutton:active {\n  box-shadow: none;\n  color: white;\n  background-color: #009458; }\n\n.button {\n  user-select: none;\n  width: 100%;\n  display: block; }\n\n/*# sourceMappingURL=Button.svelte.css.map */</style>\r\n","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = \"EAKa\";"],"sourceRoot":""}